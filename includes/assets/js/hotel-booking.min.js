!function(t){function e(t){var e=t.match(/\-/gi);if(e&&2==e.length){var a=t.split("-");return a[1]+"/"+a[0]+"/"+a[2]}return t}function a(t){return new RegExp("^[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+@[-!#$%&'*+\\/0-9=?A-Z^_`a-z{|}~]+.[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+$").test(t)}function n(t){var e=t.match(/\-/gi);if(e&&2==e.length){var a=t.split("-");t=new Date(a[2],a[1]-1,a[0])}else t=new Date(t);return!isNaN(t.getTime())}function i(e){if(!t.isPlainObject(e)){var a=e.match(/<!-- HB_AJAX_START -->(.*)<!-- HB_AJAX_END -->/);try{e=t.parseJSON(a?a[1]:e)}catch(n){console.log(n),e={}}}return e}function o(){var e=t(this),n=t('input[name="existing-customer-email"]');if(!a(n.val()))return alert(hotel_booking_l18n.invalid_email),void n.focus();e.attr("disabled",!0),n.attr("disabled",!0);var o=t(".hb-col-padding hb-col-border");t.ajax({url:hotel_settings.ajax,dataType:"html",type:"post",data:{action:"hotel_booking_fetch_customer_info",email:n.val()},beforeSend:function(){o.hb_overlay_ajax_start()},success:function(a){if(o.hb_overlay_ajax_stop(),a=i(a),a&&a.ID){var r=t("#hb-order-new-customer");for(var s in a.data){var l=s.replace(/^_hb_/,""),c=r.find('input[name="'+l+'"], select[name="'+l+'"], textarea[name="'+l+'"]');c.val(a.data[s])}r.find('input[name="existing-customer-id"]').val(a.ID),t(".hb-order-existing-customer").fadeOut(function(){})}else alert("Customer email not found!");e.removeAttr("disabled"),n.removeAttr("disabled")},error:function(){o.hb_overlay_ajax_stop(),alert(hotel_booking_l18n.ajax_error),e.removeAttr("disabled"),n.removeAttr("disabled")}})}function r(e){var n=t('select[name="title"]',e);if(-1==n.val())return alert(hotel_booking_l18n.empty_customer_title),n.focus(),!1;var i=t('input[name="first_name"]',e);if(!i.val())return alert(hotel_booking_l18n.empty_customer_first_name),i.focus(),!1;var o=t('input[name="last_name"]',e);if(!o.val())return alert(hotel_booking_l18n.empty_customer_last_name),o.focus(),!1;var r=t('input[name="address"]',e);if(!r.val())return alert(hotel_booking_l18n.empty_customer_address),r.focus(),!1;var s=t('input[name="city"]',e);if(!s.val())return alert(hotel_booking_l18n.empty_customer_city),s.focus(),!1;var l=t('input[name="state"]',e);if(!l.val())return alert(hotel_booking_l18n.empty_customer_state),l.focus(),!1;var c=t('input[name="postal_code"]',e);if(!c.val())return alert(hotel_booking_l18n.empty_customer_postal_code),c.focus(),!1;var _=t('select[name="country"]',e);if(!_.val())return alert(hotel_booking_l18n.empty_customer_country),_.focus(),!1;var d=t('input[name="phone"]',e);if(!d.val())return alert(hotel_booking_l18n.empty_customer_phone),d.focus(),!1;var u=t('input[name="email"]',e);if(!a(u.val()))return alert(hotel_booking_l18n.customer_email_invalid),u.focus(),!1;var h=t('input[name="hb-payment-method"]:checked');if(0==h.length)return alert(hotel_booking_l18n.no_payment_method_selected),!1;var f=t('input[name="tos"]');return f.length&&!f.is(":checked")?(alert(hotel_booking_l18n.confirm_tos),!1):t('input[name="existing-customer-id"]',e).val()&&u.val()!=t('input[name="existing-customer-email"]',e).val()&&!confirm(hotel_booking_l18n.customer_email_not_match)?!1:!0}function s(t){var e="pk_test_HHukcwWCsD7qDFWKKpKdJeOT";e=TPBooking_Payment_Stripe.stripe_publish;var a=StripeCheckout.configure({key:e,image:"https://stripe.com/img/documentation/checkout/marketplace.png",locale:"auto",token:function(e){l(t,e)}}),n=t.find('input[name="first_name"]').val().trim(),i=t.find('input[name="last_name"]').val().trim(),o=t.find('input[name="email"]').val().trim(),r=t.find('input[name="currency"]').val().trim(),s=0;s=t.find('input[name="pay_all"]').is(":checked")?t.find('input[name="total_price"]').val():t.find('input[name="total_advance"]').val(),a.open({name:n+" "+i,description:o,currency:r,amount:100*s})}function l(e,a){var n={},o=e.serializeArray(),r=e.find('button[type="submit"]');t.each(o,function(t,e){n[e.name]=e.value}),t.extend(a,n),t.ajax({url:hotel_settings.ajax,data:a,type:"POST",dataType:"html",beforeSend:function(){r.addClass("hb_loading")}}).done(function(t){r.removeClass("hb_loading"),t=i(t),"undefined"!=typeof t.result&&"success"==t.result?"undefined"!=typeof t.redirect&&(window.location.href=t.redirect):"undefined"!=typeof t.message&&alert(t.message)}).fail(function(){r.removeClass("hb_loading")})}function c(e){var a=window.location.href.replace(/\?.*/,"");e.attr("action",a);var n=e.find('button[type="submit"]');return e.triggerHandler("hotel_booking_place_order")!==!1&&t.ajax({type:"POST",url:hotel_settings.ajax,data:e.serialize(),dataType:"text",beforeSend:function(){n.addClass("hb_loading")},success:function(t){n.removeClass("hb_loading");try{var e=i(t);"success"==e.result?void 0!=e.redirect&&(window.location.href=e.redirect):"undefined"!=typeof e.message&&alert(e.message)}catch(a){alert(a)}},error:function(){n.removeClass("hb_loading"),alert("eror")}}),!1}function _(){var e=t('input[name="hb-coupon-code"]'),a=e.parents("table");return e.val()?void t.ajax({type:"POST",url:hotel_settings.ajax,data:{action:"hotel_booking_apply_coupon",code:e.val()},dataType:"text",beforeSend:function(){a.hb_overlay_ajax_start()},success:function(t){a.hb_overlay_ajax_stop();try{var e=i(t);"success"==e.result?window.location.href=window.location.href:alert(e.message)}catch(n){alert(n)}},error:function(){a.hb_overlay_ajax_stop(),alert("error")}}):(alert(hotel_booking_l18n.enter_coupon_code),e.focus(),!1)}var d=t(document);void 0==Date.prototype.compareWith&&(Date.prototype.compareWith=function(t){"string"==typeof t&&(t=new Date(t));var e=parseInt(this.getTime()/1e3),a=parseInt(t.getTime()/1e3);return e>a?1:a>e?-1:0}),HB_Booking_Cart={init:function(){this.add_to_cart(),this.remove_cart()},hb_add_to_cart_callback:function(e,a){var n=t(".hotel_booking_mini_cart"),i=n.length,o=wp.template("hb-minicart-item");if(o=o(e),0!==i){for(var r=0;i>r;r++){var s=t(n[r]),l=t(n[r]).find(".hb_mini_cart_item"),c=!1,_=s.find(".hb_mini_cart_empty"),d=s.find(".hb_mini_cart_footer"),u=l.length;if(0===u){var h=wp.template("hb-minicart-footer");1===_.length?(_.after(h({})),_.before(o)):d.before(o),c=!0;break}for(var f=0;u>f;f++){var m=t(l[f]),p=m.attr("data-search-key"),v=m.attr("data-id");if(e.search_key===p&&e.id==parseInt(v)){m.replaceWith(o),c=!0;break}}c===!1&&d.before(o)}t(".hb_mini_cart_empty").remove();var g=setTimeout(function(){t(".hb_mini_cart_item").removeClass("active"),clearTimeout(g)},3e3);"undefined"!=typeof a&&a()}},hb_remove_cart_item_callback:function(e,a,n){for(var i=t(".hotel_booking_mini_cart"),o=0;o<i.length;o++){for(var r=t(i[o]),s=r.find(".hb_mini_cart_item"),l=0;l<s.length;l++){var c=t(s[l]),_=c.attr("data-search-key"),d=c.attr("data-id");if(e===_&&a===d){c.remove();break}}if(s=r.find(".hb_mini_cart_item"),0===s.length){var u=wp.template("hb-minicart-empty");r.find(".hb_mini_cart_footer").remove(),r.append(u({}));break}}for(var h=t("#hotel-booking-payment, #hotel-booking-cart"),o=0;o<h.length;o++){for(var f=t(h[o]),m=f.find("table").find(".hb_checkout_item"),l=0;l<m.length;l++){var p=t(m[l]),v=p.attr("data-date"),g=p.attr("data-id");if(v===e&&g===a){p.remove();break}}"undefined"!=typeof n.sub_total&&f.find("span.hb_sub_total_value").html(n.sub_total),"undefined"!=typeof n.grand_total&&f.find("span.hb_grand_total_value").html(n.grand_total),"undefined"!=typeof n.advance_payment&&f.find("span.hb_advance_payment_value").html(n.advance_payment)}},add_to_cart:function(){var e=t("form.hb-search-room-results");e.each(function(){t(this).submit(function(e){e.preventDefault();var a=t(this),n=a.find(".hb_add_to_cart"),o=t(this).find(".number_room_select").val();if("undefined"==typeof o||""===o)return alert(hotel_settings_language.waring.room_select),!1;var r=t(this).serializeArray(),s=t(this).find(".hb-room-name");return t.ajax({url:hotel_settings.ajax,type:"POST",data:r,dataType:"html",beforeSend:function(){n.addClass("hb_loading")},success:function(t){if(a.hb_overlay_ajax_stop(),t=i(t),"undefined"!=typeof t.message){s.find(".hb_success_message").remove(),s.append(t.message);{setTimeout(function(){s.find(".hb_success_message").remove()},3e3)}}"undefined"!=typeof t.status&&"success"===t.status?hotel_settings_cart=!0:alert(t.message),"undefined"!=typeof t.id&&"undefined"!=typeof t.search_key&&HB_Booking_Cart.hb_add_to_cart_callback(t),n.removeClass("hb_loading")},error:function(){n.removeClass("hb_loading"),alert(hotel_settings_language.waring.try_again)}}),!1})})},remove_cart:function(){t(document).on("click",".hb_remove_cart_item",function(e){e.preventDefault();var a=t(this).parents("tr"),n=t(this).attr("data-date"),o=t(this).attr("data-id");t.ajax({url:hotel_settings.ajax,type:"POST",data:{time:n,room:o,nonce:hotel_settings.nonce,action:"hotel_booking_ajax_remove_item_cart"},dataType:"html",beforeSend:function(){a.hb_overlay_ajax_start()}}).done(function(e){e=i(e),("undefined"==typeof e.status||"success"!==e.status)&&alert(hotel_settings_language.waring.try_again),"undefined"!=typeof e.sub_total&&t("span.hb_sub_total_value").html(e.sub_total),"undefined"!=typeof e.grand_total&&t("span.hb_grand_total_value").html(e.grand_total),"undefined"!=typeof e.advance_payment&&t("span.hb_advance_payment_value").html(e.advance_payment),a.hb_overlay_ajax_stop(),a.remove(),HB_Booking_Cart.HB_Booking_Cart.hb_remove_cart_item_callback(n,o)})}),t(".hotel_booking_mini_cart").on("click",".hb_mini_cart_remove",function(e){e.preventDefault();var a=(t(".hotel_booking_mini_cart"),t(this).parents(".hb_mini_cart_item")),n=a.attr("data-search-key"),o=a.attr("data-id");t.ajax({url:hotel_settings.ajax,type:"POST",data:{time:n,room:o,nonce:hotel_settings.nonce,action:"hotel_booking_ajax_remove_item_cart"},dataType:"html",beforeSend:function(){a.addClass("before_remove")}}).done(function(t){return t=i(t),"undefined"==typeof t.status||"success"!==t.status?void alert(hotel_settings_language.waring.try_again):void HB_Booking_Cart.hb_remove_cart_item_callback(n,o,t)})})}},t(document).ready(function(){HB_Booking_Cart.init(),t.datepicker.setDefaults({dateFormat:"mm/dd/yy"});var a=new Date,l=new Date;l.setDate(a.getDate()+1),t('input[id^="check_in_date"]').datepicker({minDate:l,maxDate:"+365D",numberOfMonths:1,onSelect:function(){var e=t(this).attr("id");e=e.replace("check_in_date_","");var a=t(this).datepicker("getDate");a&&a.setDate(a.getDate()+1),t("#check_out_date_"+e).datepicker("option","minDate",a)}}),t('input[id^="check_out_date"]').datepicker({minDate:l,maxDate:"+365D",numberOfMonths:1,onSelect:function(e){var a=t(this).attr("id");a=a.replace("check_out_date_",""),t("#check_in_date_"+a).datepicker("option","maxDate",e)}}),t("#datepickerImage").click(function(){t("#txtFromDate").datepicker("show")}),t("#datepickerImage1").click(function(){t("#txtToDate").datepicker("show")}),t('form[class^="hb-search-form"]').submit(function(){var a=t(this).attr("class"),o=t(this).find('buton[type="submit"]');a=a.replace("hb-search-form-","");var r=t("#check_in_date_"+a,this);if(!n(r.val()))return alert(hotel_booking_l18n.empty_check_in_date),r.focus(),!1;var s=t("#check_out_date_"+a,this);if(!n(s.val()))return alert(hotel_booking_l18n.empty_check_out_date),s.focus(),!1;var l=new Date(e(r.val())),c=new Date(e(s.val())),_=new Date;if(-1==l.compareWith(_))return alert(hotel_booking_l18n.check_in_date_must_be_greater),r.focus(),!1;if(l.compareWith(c)>=0)return alert(hotel_booking_l18n.check_out_date_must_be_greater),s.focus(),!1;var d=t(this).attr("action")||window.location.href;return t.ajax({url:hotel_settings.ajax,type:"post",dataType:"html",data:t(this).serialize(),beforeSend:function(){o.addClass("hb_loading")},success:function(t){t=i(t),"undefined"!=typeof t.success&&t.success&&("undefined"!=typeof t.url?window.location.href=t.url:t.sig&&(window.location.href=d.replace(/\?.*/,"")+"?hotel-booking-params="+t.sig),o.removeClass("hb_loading"))}}),!1}),t("form#hb-payment-form").submit(function(e){e.preventDefault();var a=t(this),n=a.find('input[name="hb-payment-method"]:checked').val(),i=window.location.href.replace(/\?.*/,"");try{if(a.triggerHandler("hb_order_submit")===!1)return!1;if(a.attr("action",i),!r(a))return!1;"stripe"===n?s(a):c(a)}catch(e){alert(e)}}),t("#fetch-customer-info").click(o),d.on("click",".hb-view-booking-room-details, .hb_search_room_item_detail_price_close",function(e){e.preventDefault();var a=t(this),n=a.parents(".hb-room-content").find(".hb-booking-room-details");n.toggleClass("active")}).on("click",'input[name="hb-payment-method"]',function(){this.checked&&(t(".hb-payment-method-form:not(."+this.value+")").slideUp(),t(".hb-payment-method-form."+this.value).slideDown())}).on("click","#hb-apply-coupon",function(){_()}).on("click","#hb-remove-coupon",function(e){e.preventDefault();var a=t(this).parents("table");t.ajax({url:hotel_settings.ajax,type:"post",dataType:"html",data:{action:"hotel_booking_remove_coupon"},beforeSend:function(){a.hb_overlay_ajax_start()},success:function(t){a.hb_overlay_ajax_stop(),t=i(t),"success"==t.result&&(window.location.href=window.location.href)}})});var u=t(".hb_single_room_details"),h=u.find(".hb_single_room_tabs"),f=u.find(".hb_single_room_tabs_content"),m=t(".hb_single_room_tab_details"),p=window.location.href,v=p.match(/\#comment-[0-9]+/gi);v&&"undefined"!=typeof v[0]?(h.find("a").removeClass("active"),h.find('a[href="#hb_room_reviews"]').addClass("active")):(h.find("a:first").addClass("active"),t(".hb_single_room_tabs_content .hb_single_room_tab_details:not(:first)").hide()),m.hide();var g=h.find("a.active").attr("href");f.find(g).show(),h.find("a").on("click",function(e){e.preventDefault(),h.find("a").removeClass("active"),t(this).addClass("active");var a=t(this).attr("href");return m.hide(),f.find(a).show(),!1}),t(".hb-rating-input").rating(),t("#commentform").submit(function(){})}),t.fn.rating=function(){for(var e=this,a=this.length,n=0;a>n;n++){var i=t(e[n]),o=[];o.push('<span class="rating-input" data-rating="1"></span>'),o.push('<span class="rating-input" data-rating="2"></span>'),o.push('<span class="rating-input" data-rating="3"></span>'),o.push('<span class="rating-input" data-rating="4"></span>'),o.push('<span class="rating-input" data-rating="5"></span>'),o.push('<input name="rating" id="rating" type="hidden" value="" />'),i.html(o.join("")),i.mousemove(function(a){a.preventDefault();for(var n=e.offset(),i=a.pageX-n.left,o=t(this).find(".rating-input"),r=o.width(),s=Math.ceil(i/r),l=0;l<o.length;l++){var c=t(o[l]),_=parseInt(c.attr("data-rating"));s>=_&&c.addClass("high-light")}}).mouseout(function(a){var n=e.offset(),i=(a.pageX-n.left,t(this).find(".rating-input")),o=(i.width(),t(this).find(".rating-input.selected"));if(0===o.length)i.removeClass("high-light");else for(var r=0;r<i.length;r++){var s=t(i[r]),l=parseInt(s.attr("data-rating"));l<=parseInt(o.attr("data-rating"))?s.addClass("high-light"):s.removeClass("high-light")}}).mousedown(function(a){var n=e.offset(),o=a.pageX-n.left,r=t(this).find(".rating-input"),s=r.width(),l=Math.ceil(o/s);r.removeClass("selected").removeClass("high-light");for(var c=0;c<r.length;c++){var _=t(r[c]),d=parseInt(_.attr("data-rating"));if(d===l){_.addClass("selected").addClass("high-light");break}_.addClass("high-light")}i.find('input[name="rating"]').val(l)})}},t.fn.hb_overlay_ajax_start=function(){var t=this;t.css({position:"relative",overflow:"hidden"});var e='<div class="hb_overlay_ajax">';e+="</div>",t.append(e)},t.fn.hb_overlay_ajax_stop=function(){var t=this,e=t.find(".hb_overlay_ajax");e.addClass("hide");var a=setTimeout(function(){e.remove(),clearTimeout(a)},400)}}(jQuery);