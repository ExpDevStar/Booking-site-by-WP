!function(e){function t(e){var t=e.match(/\-/gi);if(t&&2==t.length){var a=e.split("-");return a[1]+"/"+a[0]+"/"+a[2]}return e}function a(e){return new RegExp("^[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+@[-!#$%&'*+\\/0-9=?A-Z^_`a-z{|}~]+.[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+$").test(e)}function n(e){var t=e.match(/\-/gi);if(t&&2==t.length){var a=e.split("-");e=new Date(a[2],a[1]-1,a[0])}else e=new Date(e);return!isNaN(e.getTime())}function o(t){if(!e.isPlainObject(t)){var a=t.match(/<!-- HB_AJAX_START -->(.*)<!-- HB_AJAX_END -->/);try{t=e.parseJSON(a?a[1]:t)}catch(n){console.log(n),t={}}}return t}function i(){var t=e(this),n=e('input[name="existing-customer-email"]');if(!a(n.val()))return alert(hotel_booking_l18n.invalid_email),void n.focus();t.attr("disabled",!0),n.attr("disabled",!0);var i=e(".hb-col-padding hb-col-border");e.ajax({url:hotel_settings.ajax,dataType:"html",type:"post",data:{action:"hotel_booking_fetch_customer_info",email:n.val()},beforeSend:function(){i.hb_overlay_ajax_start()},success:function(a){if(i.hb_overlay_ajax_stop(),a=o(a),a&&a.ID){var r=e("#hb-order-new-customer");for(var s in a.data){var _=s.replace(/^_hb_/,""),c=r.find('input[name="'+_+'"], select[name="'+_+'"], textarea[name="'+_+'"]');c.val(a.data[s])}r.find('input[name="existing-customer-id"]').val(a.ID),e(".hb-order-existing-customer").fadeOut(function(){})}else alert("Customer email not found!");t.removeAttr("disabled"),n.removeAttr("disabled")},error:function(){i.hb_overlay_ajax_stop(),alert(hotel_booking_l18n.ajax_error),t.removeAttr("disabled"),n.removeAttr("disabled")}})}function r(t){var n=e('select[name="title"]',t);if(-1==n.val())return alert(hotel_booking_l18n.empty_customer_title),n.focus(),!1;var o=e('input[name="first_name"]',t);if(!o.val())return alert(hotel_booking_l18n.empty_customer_first_name),o.focus(),!1;var i=e('input[name="last_name"]',t);if(!i.val())return alert(hotel_booking_l18n.empty_customer_last_name),i.focus(),!1;var r=e('input[name="address"]',t);if(!r.val())return alert(hotel_booking_l18n.empty_customer_address),r.focus(),!1;var s=e('input[name="city"]',t);if(!s.val())return alert(hotel_booking_l18n.empty_customer_city),s.focus(),!1;var _=e('input[name="state"]',t);if(!_.val())return alert(hotel_booking_l18n.empty_customer_state),_.focus(),!1;var c=e('input[name="postal_code"]',t);if(!c.val())return alert(hotel_booking_l18n.empty_customer_postal_code),c.focus(),!1;var l=e('select[name="country"]',t);if(!l.val())return alert(hotel_booking_l18n.empty_customer_country),l.focus(),!1;var d=e('input[name="phone"]',t);if(!d.val())return alert(hotel_booking_l18n.empty_customer_phone),d.focus(),!1;var u=e('input[name="email"]',t);if(!a(u.val()))return alert(hotel_booking_l18n.customer_email_invalid),u.focus(),!1;var m=e('input[name="hb-payment-method"]:checked');if(0==m.length)return alert(hotel_booking_l18n.no_payment_method_selected),!1;var h=e('input[name="tos"]');return h.length&&!h.is(":checked")?(alert(hotel_booking_l18n.confirm_tos),!1):e('input[name="existing-customer-id"]',t).val()&&u.val()!=e('input[name="existing-customer-email"]',t).val()&&!confirm(hotel_booking_l18n.customer_email_not_match)?!1:!0}function s(e){var t="pk_test_HHukcwWCsD7qDFWKKpKdJeOT";t=TPBooking_Payment_Stripe.stripe_publish;var a=StripeCheckout.configure({key:t,image:"https://stripe.com/img/documentation/checkout/marketplace.png",locale:"auto",token:function(t){_(e,t)}}),n=e.find('input[name="first_name"]').val().trim(),o=e.find('input[name="last_name"]').val().trim(),i=e.find('input[name="email"]').val().trim(),r=e.find('input[name="currency"]').val().trim(),s=0;s=e.find('input[name="pay_all"]').is(":checked")?e.find('input[name="total_price"]').val():e.find('input[name="total_advance"]').val(),a.open({name:n+" "+o,description:i,currency:r,amount:100*s})}function _(t,a){var n={},i=t.serializeArray(),r=t.find('button[type="submit"]');e.each(i,function(e,t){n[t.name]=t.value}),e.extend(a,n),e.ajax({url:hotel_settings.ajax,data:a,type:"POST",dataType:"html",beforeSend:function(){r.addClass("hb_loading")}}).done(function(e){r.removeClass("hb_loading"),e=o(e),"undefined"!=typeof e.result&&"success"==e.result?"undefined"!=typeof e.redirect&&(window.location.href=e.redirect):"undefined"!=typeof e.message&&alert(e.message)}).fail(function(){r.removeClass("hb_loading")})}function c(t){var a=window.location.href.replace(/\?.*/,"");t.attr("action",a);var n=t.find('button[type="submit"]');return t.triggerHandler("hotel_booking_place_order")!==!1&&e.ajax({type:"POST",url:hotel_settings.ajax,data:t.serialize(),dataType:"text",beforeSend:function(){n.addClass("hb_loading")},success:function(e){n.removeClass("hb_loading");try{var t=o(e);"success"==t.result?void 0!=t.redirect&&(window.location.href=t.redirect):"undefined"!=typeof t.message&&alert(t.message)}catch(a){alert(a)}},error:function(){n.removeClass("hb_loading"),alert("eror")}}),!1}function l(){var t=e('input[name="hb-coupon-code"]'),a=t.parents("table");return t.val()?void e.ajax({type:"POST",url:hotel_settings.ajax,data:{action:"hotel_booking_apply_coupon",code:t.val()},dataType:"text",beforeSend:function(){a.hb_overlay_ajax_start()},success:function(e){a.hb_overlay_ajax_stop();try{var t=o(e);"success"==t.result?window.location.href=window.location.href:alert(t.message)}catch(n){alert(n)}},error:function(){a.hb_overlay_ajax_stop(),alert("error")}}):(alert(hotel_booking_l18n.enter_coupon_code),t.focus(),!1)}var d=e(document);void 0==Date.prototype.compareWith&&(Date.prototype.compareWith=function(e){"string"==typeof e&&(e=new Date(e));var t=parseInt(this.getTime()/1e3),a=parseInt(e.getTime()/1e3);return t>a?1:a>t?-1:0}),HB_Booking_Cart={init:function(){this.add_to_cart(),this.remove_cart()},hb_add_to_cart_callback:function(t,a){var n=e(".hotel_booking_mini_cart"),o=n.length,i=wp.template("hb-minicart-item");if(i=i(t),0!==o){for(var r=0;o>r;r++){var s=e(n[r]),_=e(n[r]).find(".hb_mini_cart_item"),c=!1,l=s.find(".hb_mini_cart_empty"),d=s.find(".hb_mini_cart_footer"),u=_.length;if(0===u){var m=wp.template("hb-minicart-footer");1===l.length?(l.after(m({})),l.before(i)):d.before(i),c=!0;break}for(var h=0;u>h;h++){var f=e(_[h]),p=f.attr("data-search-key"),v=f.attr("data-id");if(t.search_key===p&&t.id==parseInt(v)){f.replaceWith(i),c=!0;break}}c===!1&&d.before(i)}e(".hb_mini_cart_empty").remove();var b=setTimeout(function(){e(".hb_mini_cart_item").removeClass("active"),clearTimeout(b)},3e3);"undefined"!=typeof a&&a()}},hb_remove_cart_item_callback:function(t,a,n){for(var o=e(".hotel_booking_mini_cart"),i=0;i<o.length;i++){for(var r=e(o[i]),s=r.find(".hb_mini_cart_item"),_=0;_<s.length;_++){var c=e(s[_]),l=c.attr("data-search-key"),d=c.attr("data-id");if(t===l&&a===d){c.remove();break}}if(s=r.find(".hb_mini_cart_item"),0===s.length){var u=wp.template("hb-minicart-empty");r.find(".hb_mini_cart_footer").remove(),r.append(u({}));break}}for(var m=e("#hotel-booking-payment, #hotel-booking-cart"),i=0;i<m.length;i++){for(var h=e(m[i]),f=h.find("table").find(".hb_checkout_item"),_=0;_<f.length;_++){var p=e(f[_]),v=p.attr("data-date"),b=p.attr("data-id");if(v===t&&b===a){p.remove();break}}"undefined"!=typeof n.sub_total&&h.find("span.hb_sub_total_value").html(n.sub_total),"undefined"!=typeof n.grand_total&&h.find("span.hb_grand_total_value").html(n.grand_total),"undefined"!=typeof n.advance_payment&&h.find("span.hb_advance_payment_value").html(n.advance_payment)}},add_to_cart:function(){var t=e("form.hb-search-room-results");t.each(function(){e(this).submit(function(t){t.preventDefault();var a=e(this),n=a.find(".hb_add_to_cart"),i=e(this).find(".number_room_select").val();if("undefined"==typeof i||""===i)return alert(hotel_settings_language.waring.room_select),!1;var r=e(this).serializeArray(),s=e(this).find(".hb-room-name");return e.ajax({url:hotel_settings.ajax,type:"POST",data:r,dataType:"html",beforeSend:function(){n.addClass("hb_loading")},success:function(e){if(a.hb_overlay_ajax_stop(),e=o(e),"undefined"!=typeof e.message){s.find(".hb_success_message").remove(),s.append(e.message);{setTimeout(function(){s.find(".hb_success_message").remove()},3e3)}}"undefined"!=typeof e.status&&"success"===e.status?hotel_settings_cart=!0:alert(e.message),"undefined"!=typeof e.id&&"undefined"!=typeof e.search_key&&HB_Booking_Cart.hb_add_to_cart_callback(e),n.removeClass("hb_loading")},error:function(){n.removeClass("hb_loading"),alert(hotel_settings_language.waring.try_again)}}),!1})})},remove_cart:function(){e(document).on("click",".hb_remove_cart_item",function(t){t.preventDefault();var a=e(this).parents("tr"),n=e(this).attr("data-date"),i=e(this).attr("data-id");e.ajax({url:hotel_settings.ajax,type:"POST",data:{time:n,room:i,nonce:hotel_settings.nonce,action:"hotel_booking_ajax_remove_item_cart"},dataType:"html",beforeSend:function(){a.hb_overlay_ajax_start()}}).done(function(t){t=o(t),("undefined"==typeof t.status||"success"!==t.status)&&alert(hotel_settings_language.waring.try_again),"undefined"!=typeof t.sub_total&&e("span.hb_sub_total_value").html(t.sub_total),"undefined"!=typeof t.grand_total&&e("span.hb_grand_total_value").html(t.grand_total),"undefined"!=typeof t.advance_payment&&e("span.hb_advance_payment_value").html(t.advance_payment),a.hb_overlay_ajax_stop(),a.remove(),HB_Booking_Cart.HB_Booking_Cart.hb_remove_cart_item_callback(n,i)})}),e(".hotel_booking_mini_cart").on("click",".hb_mini_cart_remove",function(t){t.preventDefault();var a=(e(".hotel_booking_mini_cart"),e(this).parents(".hb_mini_cart_item")),n=a.attr("data-search-key"),i=a.attr("data-id");e.ajax({url:hotel_settings.ajax,type:"POST",data:{time:n,room:i,nonce:hotel_settings.nonce,action:"hotel_booking_ajax_remove_item_cart"},dataType:"html",beforeSend:function(){a.addClass("before_remove")}}).done(function(e){return e=o(e),"undefined"==typeof e.status||"success"!==e.status?void alert(hotel_settings_language.waring.try_again):void HB_Booking_Cart.hb_remove_cart_item_callback(n,i,e)})})}},e(document).ready(function(){HB_Booking_Cart.init(),e.datepicker.setDefaults({dateFormat:"mm/dd/yy"});var a=new Date,_=new Date;_.setDate(a.getDate()+1),e('input[id^="check_in_date"]').datepicker({minDate:_,maxDate:"+365D",numberOfMonths:1,onSelect:function(){var t=e(this).attr("id");t=t.replace("check_in_date_","");var a=e(this).datepicker("getDate");a&&a.setDate(a.getDate()+1),e("#check_out_date_"+t).datepicker("option","minDate",a)}}),e('input[id^="check_out_date"]').datepicker({minDate:_,maxDate:"+365D",numberOfMonths:1,onSelect:function(t){var a=e(this).attr("id");a=a.replace("check_out_date_",""),e("#check_in_date_"+a).datepicker("option","maxDate",t)}}),e("#datepickerImage").click(function(){e("#txtFromDate").datepicker("show")}),e("#datepickerImage1").click(function(){e("#txtToDate").datepicker("show")}),e('form[class^="hb-search-form"]').submit(function(){var a=e(this).attr("class"),i=e(this).find('buton[type="submit"]');a=a.replace("hb-search-form-","");var r=e("#check_in_date_"+a,this);if(!n(r.val()))return alert(hotel_booking_l18n.empty_check_in_date),r.focus(),!1;var s=e("#check_out_date_"+a,this);if(!n(s.val()))return alert(hotel_booking_l18n.empty_check_out_date),s.focus(),!1;var _=new Date(t(r.val())),c=new Date(t(s.val())),l=new Date;if(-1==_.compareWith(l))return alert(hotel_booking_l18n.check_in_date_must_be_greater),r.focus(),!1;if(_.compareWith(c)>=0)return alert(hotel_booking_l18n.check_out_date_must_be_greater),s.focus(),!1;var d=e(this).attr("action")||window.location.href;return e.ajax({url:hotel_settings.ajax,type:"post",dataType:"html",data:e(this).serialize(),beforeSend:function(){i.addClass("hb_loading")},success:function(e){e=o(e),"undefined"!=typeof e.success&&e.success&&("undefined"!=typeof e.url?window.location.href=e.url:e.sig&&(window.location.href=d.replace(/\?.*/,"")+"?hotel-booking-params="+e.sig),i.removeClass("hb_loading"))}}),!1}),e("form#hb-payment-form").submit(function(t){t.preventDefault();var a=e(this),n=a.find('input[name="hb-payment-method"]:checked').val(),o=window.location.href.replace(/\?.*/,"");try{if(a.triggerHandler("hb_order_submit")===!1)return!1;if(a.attr("action",o),!r(a))return!1;"stripe"===n?s(a):c(a)}catch(t){alert(t)}}),e("#fetch-customer-info").click(i),d.on("click",".hb-view-booking-room-details, .hb_search_room_item_detail_price_close",function(t){t.preventDefault();var a=e(this),n=a.parents(".hb-room-content").find(".hb-booking-room-details");n.toggleClass("active")}).on("click",'input[name="hb-payment-method"]',function(){this.checked&&(e(".hb-payment-method-form:not(."+this.value+")").slideUp(),e(".hb-payment-method-form."+this.value).slideDown())}).on("click","#hb-apply-coupon",function(){l()}).on("click","#hb-remove-coupon",function(t){t.preventDefault();var a=e(this).parents("table");e.ajax({url:hotel_settings.ajax,type:"post",dataType:"html",data:{action:"hotel_booking_remove_coupon"},beforeSend:function(){a.hb_overlay_ajax_start()},success:function(e){a.hb_overlay_ajax_stop(),e=o(e),"success"==e.result&&(window.location.href=window.location.href)}})});var u=e(".hb_single_room_details"),m=u.find(".hb_single_room_tabs"),h=u.find(".hb_single_room_tabs_content"),f=e(".hb_single_room_tab_details"),p=window.location.href,v=p.match(/\#comment-[0-9]+/gi);v&&"undefined"!=typeof v[0]?(m.find("a").removeClass("active"),m.find('a[href="#hb_room_reviews"]').addClass("active")):(m.find("a:first").addClass("active"),e(".hb_single_room_tabs_content .hb_single_room_tab_details:not(:first)").hide()),f.hide();var b=m.find("a.active").attr("href");h.find(b).show(),m.find("a").on("click",function(t){t.preventDefault(),m.find("a").removeClass("active"),e(this).addClass("active");var a=e(this).attr("href");return f.hide(),h.find(a).show(),!1}),e(".hb-rating-input").rating(),e("#commentform").submit(function(){})}),e.fn.rating=function(){return e.each(this,function(){var t=e(this),a=15;t.html('<div class="rating-input"><span><input name="rating" id="rating" type="hidden" value="" /></span></div>'),e(".rating-input",t).mousemove(function(t){var n=e(this).parent().offset(),o=t.pageX-n.left,i=o-o%a+a,r=i/a;e(this).find("span").width(i).attr("rating",r)}).mouseout(function(){var t=e("input",this).val();e(this).find("span").width(t*a)}).mousedown(function(){e("input",e(this)).attr("value",e(">span",this).attr("rating")),e(this).addClass("mousedown")}).mouseup(function(){e(this).removeClass("mousedown")}),e(document.body).on("click","#respond #submit",function(){var t=e(this).closest("#respond").find("#rating"),a=t.val();return t.size()>0&&!a&&"1"===hotel_settings.settings.review_rating_required?(window.alert(hotel_booking_l18n.review_rating_required),!1):void 0})})},e.fn.hb_overlay_ajax_start=function(){var e=this;e.css({position:"relative",overflow:"hidden"});var t='<div class="hb_overlay_ajax">';t+="</div>",e.append(t)},e.fn.hb_overlay_ajax_stop=function(){var e=this,t=e.find(".hb_overlay_ajax");t.addClass("hide");var a=setTimeout(function(){t.remove(),clearTimeout(a)},400)}}(jQuery);