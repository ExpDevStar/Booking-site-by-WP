!function(a){function c(a){return Number(a)||a%1==0}function d(a){return new RegExp("^[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+@[-!#$%&'*+\\/0-9=?A-Z^_`a-z{|}~]+.[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+$").test(a)}function e(a){return a=new Date(a),!isNaN(a.getTime())}function f(b){if(!a.isPlainObject(b)){var c=b.match(/<!-- HB_AJAX_START -->(.*)<!-- HB_AJAX_END -->/);try{b=c?a.parseJSON(c[1]):a.parseJSON(b)}catch(a){b={}}}return b}function g(){var b=a(this),c=a('input[name="existing-customer-email"]');if(!d(c.val()))return c.addClass("error"),void c.focus();b.attr("disabled",!0),c.attr("disabled",!0);var e=a(".hb-col-padding.hb-col-border");a.ajax({url:hotel_settings.ajax,dataType:"html",type:"post",data:{action:"hotel_booking_fetch_customer_info",email:c.val()},beforeSend:function(){e.hb_overlay_ajax_start()},success:function(d){if(e.hb_overlay_ajax_stop(),(d=f(d))&&d.ID){var g=a("#hb-order-new-customer");for(var i in d.data){var j=i.replace(/^_hb_customer_/,"");g.find('input[name="'+j+'"], select[name="'+j+'"], textarea[name="'+j+'"]').val(d.data[i])}g.find('input[name="existing-customer-id"]').val(d.ID),a(".hb-order-existing-customer").fadeOut(function(){})}else h([hotel_booking_i18n.invalid_email]);b.removeAttr("disabled"),c.removeAttr("disabled")},error:function(){e.hb_overlay_ajax_stop(),h([hotel_booking_i18n.ajax_error]),b.removeAttr("disabled"),c.removeAttr("disabled")}})}function h(b){if(0!==b.length){a(".hotel_checkout_errors").slideUp().remove();var c=[];c.push('<div class="hotel_checkout_errors">');for(var d=0;d<b.length;d++)c.push("<p>"+b[d]+"</p>");c.push("</div>"),a("#hb-payment-form h3:first-child").after(c.join(""))}}function i(b){var c=b.find('select[name="title"]'),e=[];1==c.lenth&&-1==c.val()&&(e.push(hotel_booking_i18n.empty_customer_title),c.parents("div:first").addClass("error"));var f=b.find('input[name="first_name"]');1!=f.length||f.val()||(e.push(hotel_booking_i18n.empty_customer_first_name),f.parents("div:first").addClass("error"));var g=b.find('input[name="last_name"]');1!=g.lenth||g.val()||(e.push(hotel_booking_i18n.empty_customer_last_name),g.parents("div:first").addClass("error"));var i=b.find('input[name="address"]');1!=i.lenth||i.val()||(e.push(hotel_booking_i18n.empty_customer_address),i.parents("div:first").addClass("error"));var j=b.find('input[name="city"]');1!=j.lenth||j.val()||(e.push(hotel_booking_i18n.empty_customer_city),j.parents("div:first").addClass("error"));var k=b.find('input[name="state"]');1!=k.lenth||k.val()||(e.push(hotel_booking_i18n.empty_customer_state),k.parents("div:first").addClass("error"));var l=b.find('input[name="postal_code"]');1!=l.lenth||l.val()||(e.push(hotel_booking_i18n.empty_customer_postal_code),l.parents("div:first").addClass("error"));var m=b.find('select[name="country"]');1!=m.lenth||m.val()||(e.push(hotel_booking_i18n.empty_customer_country),m.parents("div:first").addClass("error"));var n=b.find('input[name="phone"]');1!=n.lenth||n.val()||(e.push(hotel_booking_i18n.empty_customer_phone),n.parents("div:first").addClass("error"));var o=b.find('input[name="email"]');1!=o.lenth||d(o.val())||(e.push(hotel_booking_i18n.customer_email_invalid),o.parents("div:first").addClass("error"));var p=b.find('input[name="hb-payment-method"]:checked');1==p.lenth&&0==p.length&&(e.push(hotel_booking_i18n.no_payment_method_selected),p.parents("div:first").addClass("error"));var q=b.find('input[name="tos"]');return q.length&&!q.is(":checked")&&(e.push(hotel_booking_i18n.confirm_tos),q.addClass("error")),a('input[name="existing-customer-id"]').val()&&(o.val()!=a('input[name="existing-customer-email"]',b).val()&&e.push(hotel_booking_i18n.customer_email_not_match),o.parents("div:first").addClass("error"),b.find('input[name="existing-customer-id"]').parents("div:first").addClass("error")),!(e.length>0)||(h(e),!1)}function j(a){var b="pk_test_HHukcwWCsD7qDFWKKpKdJeOT";"undefined"!=typeof TPBooking_Payment_Stripe&&(b=TPBooking_Payment_Stripe.stripe_publish);var c=StripeCheckout.configure({key:b,image:"https://stripe.com/img/documentation/checkout/marketplace.png",locale:"auto",token:function(b){k(a,b)}}),d=a.find('input[name="first_name"]').val().trim(),e=a.find('input[name="last_name"]').val().trim(),f=a.find('input[name="email"]').val().trim(),g=a.find('input[name="currency"]').val().trim(),h=0;h=a.find('input[name="pay_all"]').is(":checked")?a.find('input[name="total_price"]').val():a.find('input[name="total_advance"]').val(),c.open({name:d+" "+e,description:f,currency:g,amount:100*h})}function k(b,c){var d={},e=b.serializeArray(),g=b.find('button[type="submit"]');a.each(e,function(a,b){d[b.name]=b.value}),a.extend(c,d),a.ajax({url:hotel_settings.ajax,data:c,type:"POST",dataType:"html",beforeSend:function(){g.addClass("hb_loading")}}).done(function(a){g.removeClass("hb_loading"),a=f(a),void 0!==a.result&&"success"==a.result?void 0!==a.redirect&&(window.location.href=a.redirect):void 0!==a.message&&alert(a.message)}).fail(function(){g.removeClass("hb_loading")})}function l(b){var c=window.location.href.replace(/\?.*/,"");b.attr("action",c);var d=b.find('button[type="submit"]');return!1!==b.triggerHandler("hotel_booking_place_order")&&a.ajax({type:"POST",url:hotel_settings.ajax,data:b.serialize(),dataType:"text",beforeSend:function(){d.addClass("hb_loading")},success:function(a){d.removeClass("hb_loading");try{var b=f(a);"success"==b.result?void 0!=b.redirect&&(window.location.href=b.redirect):void 0!==b.message&&alert(b.message)}catch(a){alert(a)}},error:function(){d.removeClass("hb_loading"),h([hotel_booking_i18n.waring.try_again])}}),!1}function m(){var b=a('input[name="hb-coupon-code"]'),c=b.parents("table");if(!b.val())return alert(hotel_booking_i18n.enter_coupon_code),b.focus(),!1;a.ajax({type:"POST",url:hotel_settings.ajax,data:{action:"hotel_booking_apply_coupon",code:b.val()},dataType:"text",beforeSend:function(){c.hb_overlay_ajax_start()},success:function(a){c.hb_overlay_ajax_stop();try{var b=f(a);"success"==b.result?window.location.href=window.location.href:alert(b.message)}catch(a){alert(a)}},error:function(){c.hb_overlay_ajax_stop(),alert("error")}})}var b=a(document);void 0==Date.prototype.compareWith&&(Date.prototype.compareWith=function(a){"string"==typeof a&&(a=new Date(a));var b=parseInt(this.getTime()/1e3),c=parseInt(a.getTime()/1e3);return b>c?1:b<c?-1:0}),HB_Booking_Cart={init:function(){this.add_to_cart(),this.remove_cart()},hb_add_to_cart_callback:function(b,c){var d=a(".hotel_booking_mini_cart"),e=d.length,f=wp.template("hb-minicart-item");if(f=f(b),e>0)for(var g=0;g<e;g++){var h=a(d[g]),i=a(d[g]).find(".hb_mini_cart_item"),j=!1,k=h.find(".hb_mini_cart_empty"),l=h.find(".hb_mini_cart_footer"),m=i.length;if(0===m){var n=wp.template("hb-minicart-footer");1===k.length?(k.after(n({})),k.before(f)):l.before(f),j=!0;break}for(var p=0;p<m;p++){var q=a(i[p]),r=q.attr("data-cart-id");if(b.cart_id===r){q.replaceWith(f),j=!0;break}}!1===j&&l.before(f)}a(".hb_mini_cart_empty").remove();var s=setTimeout(function(){a(".hb_mini_cart_item").removeClass("active"),clearTimeout(s)},3500);void 0!==c&&c()},hb_remove_cart_item_callback:function(b,c){for(var d=a(".hotel_booking_mini_cart"),e=0;e<d.length;e++){for(var f=a(d[e]),g=f.find(".hb_mini_cart_item"),h=0;h<g.length;h++){var i=a(g[h]),j=i.attr("data-cart-id");if(b===j){i.remove();break}}if(g=f.find(".hb_mini_cart_item"),0===g.length){var k=wp.template("hb-minicart-empty");f.find(".hb_mini_cart_footer").remove(),f.append(k({}));break}}for(var l=a("#hotel-booking-payment, #hotel-booking-cart"),e=0;e<l.length;e++){for(var m=a(l[e]),n=m.find("table").find(".hb_checkout_item, .hb_addition_services_title"),h=0;h<n.length;h++){var o=a(n[h]);j=o.attr("data-cart-id"),parent_item_id=o.attr("data-parent-id"),b!==j&&b!==parent_item_id||o.remove()}void 0!==c.sub_total&&m.find("span.hb_sub_total_value").html(c.sub_total),void 0!==c.grand_total&&m.find("span.hb_grand_total_value").html(c.grand_total),void 0!==c.advance_payment&&m.find("span.hb_advance_payment_value").html(c.advance_payment)}},add_to_cart:function(){a("form.hb-search-room-results");a(document).on("submit","form.hb-search-room-results",function(b){b.preventDefault();var c=a(this),d=c.find(".hb_add_to_cart"),e=c.find(".number_room_select"),g=c.find(".number_room_select option:selected").val(),h=c.find(".hb-room-name");if(a(".number_room_select").removeClass("hotel_booking_invalid_quantity"),void 0===g||""===g){e.addClass("hotel_booking_invalid_quantity"),h.find(".hb_success_message").remove(),h.append('<label class="hb_success_message">'+hotel_booking_i18n.waring.room_select+"</label>");setTimeout(function(){h.find(".hb_success_message").remove()},2e3);return!1}var j=a(this).serializeArray();return a.ajax({url:hotel_settings.ajax,type:"POST",data:j,dataType:"html",beforeSend:function(){d.addClass("hb_loading")},success:function(b){if(c.hb_overlay_ajax_stop(),b=f(b),void 0!==b.message){h.find(".hb_success_message").remove(),h.append(b.message);setTimeout(function(){h.find(".hb_success_message").remove()},3e3)}void 0!==b.status&&"success"===b.status?(a("body").trigger("hb_added_item_to_cart"),void 0!==b.redirect&&(window.location.href=b.redirect)):alert(b.message),void 0!==b.id&&HB_Booking_Cart.hb_add_to_cart_callback(b),d.removeClass("hb_loading")},error:function(){d.removeClass("hb_loading"),alert(hotel_booking_i18n.waring.try_again)}}),!1})},remove_cart:function(){a(document).on("click",".hb_remove_cart_item",function(b){b.preventDefault();var c=a(this).parents("tr"),d=a(this).attr("data-cart-id");a.ajax({url:hotel_settings.ajax,type:"POST",data:{cart_id:d,nonce:hotel_settings.nonce,action:"hotel_booking_ajax_remove_item_cart"},dataType:"html",beforeSend:function(){c.hb_overlay_ajax_start()}}).done(function(b){b=f(b),void 0!==b.status&&"success"===b.status||alert(hotel_booking_i18n.waring.try_again),a("body").trigger("hb_removed_item_to_cart"),void 0!==b.sub_total&&a("span.hb_sub_total_value").html(b.sub_total),void 0!==b.grand_total&&a("span.hb_grand_total_value").html(b.grand_total),void 0!==b.advance_payment&&a("span.hb_advance_payment_value").html(b.advance_payment),c.hb_overlay_ajax_stop(),c.remove(),HB_Booking_Cart.hb_remove_cart_item_callback(d,b)})}),a(".hotel_booking_mini_cart").on("click",".hb_mini_cart_remove",function(b){b.preventDefault();var d=(a(".hotel_booking_mini_cart"),a(this).parents(".hb_mini_cart_item")),e=d.attr("data-cart-id");a.ajax({url:hotel_settings.ajax,type:"POST",data:{cart_id:e,nonce:hotel_settings.nonce,action:"hotel_booking_ajax_remove_item_cart"},dataType:"html",beforeSend:function(){d.addClass("before_remove"),d.hb_overlay_ajax_start()}}).done(function(a){if(a=f(a),void 0===a.status||"success"!==a.status)return void alert(hotel_booking_i18n.waring.try_again);HB_Booking_Cart.hb_remove_cart_item_callback(e,a),d.hb_overlay_ajax_stop()})})}},a(document).ready(function(){HB_Booking_Cart.init(),a.datepicker.setDefaults({dateFormat:hotel_booking_i18n.date_time_format});var d=new Date,h=new Date,k=a(document).triggerHandler("hotel_booking_min_check_in_date",[1,d,h]);k=parseInt(k),c(k)||(k=1),h.setDate(d.getDate()+k),a('input[id^="check_in_date"]').datepicker({dateFormat:hotel_booking_i18n.date_time_format,firstDay:hotel_booking_i18n.date_start,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,minDate:d,maxDate:"+365D",numberOfMonths:1,onSelect:function(){var b=a(this).attr("id");b=b.replace("check_in_date_","");var d=a(this).datepicker("getDate"),e=hotel_settings.min_booking_date;c(e)||(e=1),d&&d.setDate(d.getDate()+e),a("#check_out_date_"+b).datepicker("option","minDate",d)}}).on("click",function(){a(this).datepicker("show")}),a('input[id^="check_out_date"]').datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,minDate:h,maxDate:"+365D",numberOfMonths:1,onSelect:function(){var b=a(this).attr("id");b=b.replace("check_out_date_","");var d=a("#check_in_date_"+b),e=a(this).datepicker("getDate"),f=hotel_settings.min_booking_date;c(f)||(f=1),e.setDate(e.getDate()-f),d.datepicker("option","maxDate",e)}}).on("click",function(){a(this).datepicker("show")}),a("#datepickerImage").click(function(){a("#txtFromDate").datepicker("show")}),a("#datepickerImage1").click(function(){a("#txtToDate").datepicker("show")}),a('form[class^="hb-search-form"]').submit(function(b){b.preventDefault();var c=a(this),d=c.attr("class"),g=c.find('button[type="submit"]');d=d.replace("hb-search-form-",""),c.find("input, select").removeClass("error");var h=a("#check_in_date_"+d);if(""===h.val()||!e(h.datepicker("getDate")))return h.addClass("error"),!1;var i=a("#check_out_date_"+d);if(""===i.val()||!e(i.datepicker("getDate")))return i.addClass("error"),!1;if(null===h.datepicker("getDate"))return h.addClass("error"),!1;if(null===i.datepicker("getDate"))return i.addClass("error"),!1;var j=new Date(h.datepicker("getDate")),k=new Date(i.datepicker("getDate"));new Date;if(j.compareWith(k)>=0)return h.addClass("error"),error=!0,!1;for(var m=a(this).attr("action")||window.location.href,n=a(this).serializeArray(),o=0;o<n.length;o++){var p=n[o];if("check_in_date"===p.name||"check_out_date"===p.name){var q=a(this).find('input[name="'+p.name+'"]').datepicker("getDate");q=new Date(q),n.push({name:"hb_"+p.name,value:q.getTime()/1e3-60*q.getTimezoneOffset()})}}return a.ajax({url:hotel_settings.ajax,type:"post",dataType:"html",data:n,beforeSend:function(){g.addClass("hb_loading")},success:function(a){a=f(a),void 0!==a.success&&a.success&&(void 0!==a.url?window.location.href=a.url:a.sig&&(-1===m.indexOf("?")?m+="?hotel-booking-params="+a.sig:m+="&hotel-booking-params="+a.sig,window.location.href=m))}}),!1}),a("form#hb-payment-form").submit(function(b){b.preventDefault();var c=a(this),d=c.find('input[name="hb-payment-method"]:checked').val(),e=window.location.href.replace(/\?.*/,"");c.find(".hotel_checkout_errors").slideUp().remove(),c.find("input, select").parents("div:first-child").removeClass("error");try{if(!1===c.triggerHandler("hb_order_submit"))return!1;if(c.attr("action",e),!i(c))return!1;"stripe"===d?j(c):l(c)}catch(b){alert(b)}}),a("#fetch-customer-info").click(g),b.on("click",".hb-view-booking-room-details, .hb_search_room_item_detail_price_close",function(b){b.preventDefault(),a(this).parents(".hb-room-content").find(".hb-booking-room-details").toggleClass("active")}).on("click",'input[name="hb-payment-method"]',function(){this.checked&&(a(".hb-payment-method-form:not(."+this.value+")").slideUp(),a(".hb-payment-method-form."+this.value).slideDown())}).on("click","#hb-apply-coupon",function(){m()}).on("click","#hb-remove-coupon",function(b){b.preventDefault();var c=a(this).parents("table");a.ajax({url:hotel_settings.ajax,type:"post",dataType:"html",data:{action:"hotel_booking_remove_coupon"},beforeSend:function(){c.hb_overlay_ajax_start()},success:function(a){c.hb_overlay_ajax_stop(),a=f(a),"success"==a.result&&(window.location.href=window.location.href)}})});var n=a(".hb_single_room_details"),o=n.find(".hb_single_room_tabs"),p=n.find(".hb_single_room_tabs_content"),q=a(".hb_single_room_tab_details"),r=window.location.href,s=r.match(/\#comment-[0-9]+/gi);s&&void 0!==s[0]?(o.find("a").removeClass("active"),o.find('a[href="#hb_room_reviews"]').addClass("active")):(o.find("a:first").addClass("active"),a(".hb_single_room_tabs_content .hb_single_room_tab_details:not(:first)").hide()),q.hide();var t=o.find("a.active").attr("href");p.find(t).fadeIn(),o.find("a").on("click",function(b){b.preventDefault(),o.find("a").removeClass("active"),a(this).addClass("active");var c=a(this).attr("href");return q.hide(),p.find(c).fadeIn(),!1}),a(".hb-rating-input").rating(),a("#commentform").submit(function(){var b=a("#rating"),c=b.val();if(1===b.length&&void 0!==c&&""===c)return window.alert(hotel_booking_i18n.review_rating_required),!1;a(this).submit()})}),a.fn.rating=function(){for(var b=this,c=this.length,d=0;d<c;d++){var e=a(b[d]),f=[];f.push('<span class="rating-input" data-rating="1"></span>'),f.push('<span class="rating-input" data-rating="2"></span>'),f.push('<span class="rating-input" data-rating="3"></span>'),f.push('<span class="rating-input" data-rating="4"></span>'),f.push('<span class="rating-input" data-rating="5"></span>'),f.push('<input name="rating" id="rating" type="hidden" value="" />'),e.html(f.join("")),e.mousemove(function(c){c.preventDefault();for(var d=b.offset(),e=c.pageX-d.left,f=a(this).find(".rating-input"),g=f.width(),h=Math.ceil(e/g),i=0;i<f.length;i++){var j=a(f[i]);parseInt(j.attr("data-rating"))<=h&&j.addClass("high-light")}}).mouseout(function(c){var d=b.offset(),f=(c.pageX,d.left,a(this).find(".rating-input")),h=(f.width(),a(this).find(".rating-input.selected"));if(0===h.length)f.removeClass("high-light");else for(var i=0;i<f.length;i++){var j=a(f[i]),k=parseInt(j.attr("data-rating"));k<=parseInt(h.attr("data-rating"))?j.addClass("high-light"):j.removeClass("high-light")}}).mousedown(function(c){var d=b.offset(),f=c.pageX-d.left,g=a(this).find(".rating-input"),h=g.width(),i=Math.ceil(f/h);g.removeClass("selected").removeClass("high-light");for(var j=0;j<g.length;j++){var k=a(g[j]);if(parseInt(k.attr("data-rating"))===i){k.addClass("selected").addClass("high-light");break}k.addClass("high-light")}e.find('input[name="rating"]').val(i)})}},a.fn.hb_overlay_ajax_start=function(){var a=this;a.css({position:"relative",overflow:"hidden"});var b='<div class="hb_overlay_ajax">';b+="</div>",a.append(b)},a.fn.hb_overlay_ajax_stop=function(){var a=this,b=a.find(".hb_overlay_ajax");b.addClass("hide");var c=setTimeout(function(){b.remove(),clearTimeout(c)},400)}}(jQuery);