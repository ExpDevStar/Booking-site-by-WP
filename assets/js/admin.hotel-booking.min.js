!function(a){function d(a){return a=new Date(a),!isNaN(a.getTime())}function f(b){a(b).find(".datepicker").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(c){var d=a(this),e=d.datepicker("getDate"),f=new Date(e).getTime()/1e3-60*new Date(e).getTimezoneOffset(),g=d.attr("name"),h=!1;0===g.indexOf("date-start")?h=g.replace("date-start","date-start-timestamp"):0===g.indexOf("date-end")&&(h=g.replace("date-end","date-end-timestamp")),h&&a(b).find('input[name="'+h+'"]').val(f)}})}function g(){function c(){for(var b=a(".hotel-booking-fullcalendar"),c=0;c<b.length;c++){var d=a(b[c]),e=d.attr("data-events");"undefined"==typeof e&&(e=[]),d.fullCalendar({header:{left:"",right:""},ignoreTimezone:!1,handleWindowResize:!0,editable:!1,defaultView:"singleRowMonth",events:function(a,b,c,d){d(JSON.parse(e))}})}}b.on("click",".hb-pricing-controls a",function(b){var c=a(this),d=c.closest(".hb-pricing-table"),e=c.data("action");switch(b.preventDefault(),e){case"clone":var g=!1;a(".hb-pricing-table").length<1&&(g=!0);var h=a(wp.template("hb-pricing-table")({clone:g})),i=h.find(".hb-pricing-price");h.hide().css("background-color","#00A0D2").css("transition","background-color 0.5s"),f(h),d.find(".hb-pricing-price").each(function(a){i.eq(a).val(this.value)}),d.hasClass("regular-price")?(h.removeClass("regular-price"),a(".hb-pricing-table-title > span",h).html("Date Range"),a("#hb-pricing-plan-list").append(h)):h.insertAfter(d),h.fadeTo(350,.8).delay(1e3).fadeTo(250,1,function(){a(this).css("background-color",""),a(".dashicons-edit",this).trigger("click")}),a("#hb-no-plan-message").hide();break;case"edit":c.hasClass("dashicons-edit")?(a("input",d).removeAttr("readonly"),a("input",d).datepicker("enable"),c.removeClass("dashicons-edit").addClass("dashicons-yes"),a(".hb-pricing-table .dashicons-yes").not(c).trigger("click")):(a("input",d).attr("readonly","readonly"),a("input",d).datepicker("disable"),c.removeClass("dashicons-yes").addClass("dashicons-edit"));break;case"remove":confirm(hotel_booking_i18n.confirm_remove_pricing_table)&&(0==d.siblings(".hb-pricing-table").length&&a("#hb-no-plan-message").show(),d.remove())}return!1}),a("#tp_hotel_booking_pricing #hb-room-select").change(function(){var a=window.location.href;a=a.replace(/[&]?hb-room=[0-9]+/,""),0!=this.value&&(a+="&hb-room="+this.value),window.location.href=a}),a('form[name="pricing-table-form"]').submit(function(){var b=!0;return a(".hb-pricing-table").each(function(c){var e=a(this),f=e.find('input[name^="date-start"]'),g=e.find('input[name^="date-end"]');return!(!e.hasClass("regular-price")&&(d(f.datepicker("getDate"))?d(g.datepicker("getDate"))||(alert(hotel_booking_i18n.empty_pricing_plan_start_date),g.focus(),b=!1):(alert(hotel_booking_i18n.empty_pricing_plan_start_date),f.focus(),b=!1),!b))&&void e.find('input[type="text"], input[type="number"], input[type="hidden"]').each(function(){var b=a(this),d=b.attr("name");d=d.replace(/__INDEX__/,c-1e3),b.attr("name",d)})}),b}),a(".hb-pricing-table").each(function(){f(this)});var e=new Date,g=[];g.push(e.getYear()+"-"+e.getMonth()),c(),a(document).on("click",".hotel-booking-fullcalendar-toolbar .fc-button",function(b){b.preventDefault();var c=a(this),d=a(".hotel-booking-fullcalendar"),e=c.attr("data-room"),f=c.attr("data-month");return a.ajax({url:ajaxurl,type:"POST",data:{action:"hotel_booking_load_other_full_calendar",nonce:hotel_settings.nonce,room_id:e,date:f},beforeSend:function(){c.append('<i class="fa fa-spinner fa-spin"></i>')}}).done(function(b){if(c.find(".fa").remove(),b.status===!0){var e=JSON.parse(b.events);try{var f=new Date(e[0].start),h=f.getYear()+"-"+f.getMonth();if(g.indexOf(h)==-1){g.push(h);for(var i=0;i<e.length;i++){var j=e[i];d.fullCalendar("renderEvent",j,!0)}}}catch(a){console.debug(a)}a(".hotel-booking-fullcalendar").fullCalendar("refetchEvents"),c.hasClass("fc-next-button")?d.fullCalendar("next"):d.fullCalendar("prev"),a(".hotel-booking-fullcalendar-month").text(b.month_name),a(".hotel-booking-fullcalendar-toolbar .fc-next-button").attr("data-month",b.next),a(".hotel-booking-fullcalendar-toolbar .fc-prev-button").attr("data-month",b.prev)}}).fail(function(){c.find(".fa").remove()}),!1}),a(".datetime-picker-metabox").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,minDate:0,maxDate:"+365D",numberOfMonths:2,onSelect:function(b){var c=a(this),d=c.attr("name"),e=jQuery(this).datepicker("getDate"),f=new Date(e).getTime()/1e3-60*(new Date).getTimezoneOffset();e&&e.setDate(e.getDate()+1),a('input[name="'+d+'_timestamp"]').val(f)}}),a("#datepickerImage").click(function(){a("#txtFromDate").datepicker("show")}),a("#hb-booking-date-from").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var b=a(this),c=b.datepicker("getDate"),d=new Date(c).getTime()/1e3-60*(new Date).getTimezoneOffset();b.parent().find('input[name="date-from-timestamp"]').val(d),a("#hb-booking-date-to").datepicker("option","minDate",c)}}),a("#hb-booking-date-to").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var b=a(this),c=b.datepicker("getDate"),d=new Date(c).getTime()/1e3-60*(new Date).getTimezoneOffset();b.parent().find('input[name="date-to-timestamp"]').val(d),a("#hb-booking-date-from").datepicker("option","maxDate",c)}}),a("form#posts-filter").submit(function(){var b=0;if(a('#hb-booking-date-from, #hb-booking-date-to, select[name="filter-type"]').each(function(){a(this).val()&&b++}),b>0&&b<3)return alert(hotel_booking_i18n.filter_error),!1}),a("#gallery_settings").on("click",".attachment.add-new",function(b){b.preventDefault();var c=wp.media.frames.file_frame=wp.media({multiple:!0}),d=a(this);c.on("select",function(){for(var a=c.state().get("selection").toJSON(),b="",e=0;e<a.length;e++){var f=a[e];f.url.replace(hotel_settings.upload_base_url,"");b+='<li class="attachment">',b+='<div class="attachment-preview">',b+='<div class="thumbnail">',b+='<div class="centered">',b+='<img src="'+f.url+'"/>',b+='<input type="hidden" name="_hb_gallery[]" value="'+f.id+'" />',b+="</div>",b+="</div>",b+="</div>",b+='<a class="dashicons dashicons-trash" title="Remove this image"></a>',b+="</li>"}d.before(b)}),c.open()}).on("click",".attachment .dashicons-trash",function(b){b.preventDefault(),a(this).parent().remove()}),a('form[name="hb-admin-settings-form"] select').select2(),a("#hb-booking-details select").select2(),a(".hb-form-field .hb-form-field-input select").select2(),a('input[name="tp_hotel_booking_email_new_booking_enable"]').on("change _change",function(){var b=a(this).closest("tr").siblings("."+a(this).attr("name"));this.checked?b.show():b.hide()}).trigger("change"),a("#gallery_settings ul").sortable(),a(".tp_hotel_booking_tabs_settings li a:first").addClass("active"),a(".tp_hotel_booking_setting_fields:first").addClass("active"),a(document).on("click",".tp_hotel_booking_tabs_settings li a",function(b){b.preventDefault();var c=a(this),d=c.attr("href"),e=a(d);"undefined"!=typeof d&&(a(".tp_hotel_booking_setting_fields").removeClass("active"),a(".tp_hotel_booking_tabs_settings li a").removeClass("active"),c.addClass("active"),1===e.length&&e.addClass("active"))}),a(document).on("click",".hb-dismiss-notice button",function(b){var c=a(this).closest(".hb-dismiss-notice");c.length&&(b.preventDefault(),a.ajax({url:ajaxurl,type:"POST",data:{action:"hotel_booking_dismiss_notice"}}))})}var b=a(document);void 0==Date.prototype.compareWith&&(Date.prototype.compareWith=function(a){"string"==typeof a&&(a=new Date(a));var b=parseInt(this.getTime()/1e3),c=parseInt(a.getTime()/1e3);return b>c?1:b<c?-1:0}),b.ready(g),Hotel_Booking_Order={init:function(){var b=a(document),c=this;c.select2(),b.on("click",".section h4 .edit",c.edit_customer),b.on("change","#booking-item-checkall",c.toggle_checkbox),b.on("click","#add_room_item",c.add_room_item).on("click","#add_coupon",c.add_coupon).on("click","#remove_coupon",c.remove_coupon).on("click","#action_sync",c.action_sync).on("click","#booking_items .actions .edit",c.edit_room).on("click","#booking_items .actions .remove",c.remove_room).on("hb_modal_open",this.openCallback).on("hb_check_available_action",this.check_available).on("hb_before_update_action",this.save_action)},edit_customer:function(b,c,d){b.preventDefault();var e=a(this),f=e.parents(".section:first"),g=f.find(".details"),h=f.find(".edit_details");h.hasClass("active")||(e.hide(),g.hide(),h.addClass("active"))},toggle_checkbox:function(b){b.preventDefault();var c=a(this),d=a('#booking_items input[name*="book_item"]');c.is(":checked")?d.attr("checked",!0):d.attr("checked",!1)},edit_customer:function(b){b.preventDefault();var c=a(this),d=c.parents(".section:first"),e=d.find(".details"),f=d.find(".edit_details");f.hasClass("active")||(c.hide(),e.hide(),f.addClass("active"))},toggle_checkbox:function(b){b.preventDefault();var c=a(this),d=a('#booking_items input[name*="book_item"]');c.is(":checked")?d.attr("checked",!0):d.attr("checked",!1)},select2:function(){a("#booking_details_section #_hb_user_id").select2({placeholder:hotel_booking_i18n.select_user,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",quietMillis:50,data:function(a){return{user_name:a.term,action:"hotel_booking_load_order_user",nonce:hotel_settings.nonce}},processResults:function(b){return{results:a.map(b,function(a){return{text:a.user_login+"(#"+a.ID+" "+a.user_email+")",id:a.ID}})}},cache:!0}})},add_room_item:function(b){b.preventDefault();var c=a(this),d=c.attr("data-order-id");return a(this).hb_modal_box({tmpl:"hb-add-room",settings:{order_id:d}}),!1},add_coupon:function(b,c,d){b.preventDefault();var e=a(this),f=e.attr("data-order-id");return a(this).hb_modal_box({tmpl:"hb-coupons",settings:{order_id:f}}),!1},remove_coupon:function(b,c,d){b.preventDefault();var e=a(this),f=e.attr("data-order-id"),g=e.attr("data-coupon-id");return a(this).hb_modal_box({tmpl:"hb-confirm",settings:{order_id:f,coupon_id:g,action:"hotel_booking_remove_coupon_on_order"}}),!1},action_sync:function(b){b.preventDefault();var c=a(this),d=a("#hb-booking-items"),f=(d.find(".hb_overlay"),a('input[name*="book_item"]:checked')),g={};if(_do_process=!1,f.length>0){_do_process=!0;for(var h=0;h<f.length;h++)g[h]=a(f[h]).val()}return _do_process&&c.hb_modal_box({tmpl:"hb-confirm",settings:{order_id:c.attr("data-order-id"),order_item_id:g,action:"hotel_booking_admin_remove_order_items"}}),!1},edit_room:function(b){b.preventDefault(),b.stopPropagation();var c=a(this),d=c.attr("data-order-id"),e=c.attr("data-order-item-id"),f=c.attr("data-order-item-type"),h=(c.attr("data-order-item-parent"),c.find(".fa"));return a.ajax({url:ajaxurl,type:"POST",data:{order_id:d,order_item_id:e,order_item_type:f,action:"hotel_booking_load_order_item",nonce:hotel_settings.nonce},beforeSend:function(){h.addClass("fa-spin")}}).done(function(a){h.removeClass("fa-spin"),c.hb_modal_box({tmpl:"hb-add-room",settings:a})}),!1},remove_room:function(b){b.preventDefault();var c=a(this);return c.hb_modal_box({tmpl:"hb-confirm",settings:{order_id:c.attr("data-order-id"),order_item_id:c.attr("data-order-item-id"),action:"hotel_booking_admin_remove_order_item"}}),!1},openCallback:function(b,c,d){if(b.preventDefault(),"hb-add-room"===c){var e=d.find(".check_in_date"),f=d.find(".check_out_date"),g=d.find(".booking_search_room_items");g.select2({placeholder:hotel_booking_i18n.select_room,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",quietMillis:50,data:function(a){return{room:a.term,action:"hotel_booking_load_room_ajax",nonce:hotel_settings.nonce}},processResults:function(b){return{results:a.map(b,function(a){return{text:a.post_title,id:a.ID}})}},cache:!0}}),e.datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var b=a(this),c=b.datepicker("getDate"),d=new Date(c).getTime()/1e3-60*(new Date).getTimezoneOffset();b.parent().find('input[name="check_in_date_timestamp"]').val(d),f.datepicker("option","minDate",c)}}),f.datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var b=a(this),c=b.datepicker("getDate"),d=new Date(c).getTime()/1e3-60*(new Date).getTimezoneOffset();b.parent().find('input[name="check_out_date_timestamp"]').val(d),e.datepicker("option","maxDate",c)}})}else if("hb-coupons"===c){var g=d.find(".booking_coupon_code");g.select2({placeholder:hotel_booking_i18n.select_coupon,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",quietMillis:50,data:function(a){return{coupon:a.term,action:"hotel_booking_load_coupon_ajax",nonce:hotel_settings.nonce}},processResults:function(b){return{results:a.map(b,function(a){return{text:a.post_title,id:a.ID}})}},cache:!0}})}},check_available:function(b,c,d){b.preventDefault(),b.stopPropagation();var f=(a(this),a(".form_footer .check_available"));d.push({name:"action",value:"hotel_booking_check_room_available"}),a.ajax({url:ajaxurl,type:"POST",data:d,beforeSend:function(){f.append('<i class="fa fa-spinner fa-spin"></i>'),a('select[name="qty"]').remove()}}).done(function(b){if(f.find(".fa").remove(),"undefined"!=typeof b.status)return b.status===!1&&"undefined"!=typeof b.message?void alert(b.message):void a("#hb_modal_dialog .section:last-child").append(wp.template("hb-qty")(b))})},save_action:function(b,c,d){var e=a("#hb-booking-items"),f=e.find(".hb_overlay");a.ajax({url:ajaxurl,type:"POST",data:d,beforeSend:function(){f.addClass("active")}}).done(function(b){f.removeClass("active"),"undefined"!=typeof b.status&&(b.status===!0?a("#hb-booking-items").html(b.html):"undefined"!=typeof b.message&&alert(b.message))})}},a(document).ready(function(){Hotel_Booking_Order.init()})}(jQuery),function(a,b,c){a.fn.hb_modal_box=function(b){var b=a.extend({},{tmpl:"",settings:{}},b);b.tmpl&&new d.view(b.tmpl,b.settings)};var d={view:function(c,d){var e=b.View.extend({id:"hb_modal_dialog",options:d,target:c,events:{"click .hb_modal_close":"close","click .hb_modal_overlay":"close","click .hb_form_submit":"submit","click .check_available":"check_available"},initialize:function(a){this.render()},render:function(){var b=wp.template(this.target);b=b(this.options),a("body").append(this.$el.html(b));var c=a(".hb_modal"),d=c.outerWidth(),e=c.outerHeight();a(window).width(),a(window).height(),a("#wpadminbar").innerWidth();c.css({"margin-top":"-"+e/2+"px","margin-left":"-"+d/2+"px"}),a(document).trigger("hb_modal_open",[this.target,c.find("form")])},submit:function(){return a(document).trigger("hb_before_update_action",[this.target,this.form_data()]),this.close(),a(document).trigger("hb_before_updated_action",[this.target,this.form_data()]),!1},close:function(){return a(document).trigger("hb_before_close_action",[this.target,this.form_data()]),this.$el.remove(),!1},check_available:function(b){return a(document).trigger("hb_check_available_action",[this.target,this.form_data()]),!1},form_data:function(){return _form=a(this.$el).find("form:first-child").serializeArray()}});return new e(d)}}}(jQuery,Backbone,_);