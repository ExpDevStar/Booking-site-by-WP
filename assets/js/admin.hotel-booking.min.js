!function(e){function t(e){return e=new Date(e),!isNaN(e.getTime())}function o(t){e(t).find(".datepicker").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var o=e(this),a=o.datepicker("getDate"),i=new Date(a).getTime()/1e3-60*(new Date).getTimezoneOffset(),n=o.attr("name"),r=!1;0===n.indexOf("date-start")?r=n.replace("date-start","date-start-timestamp"):0===n.indexOf("date-end")&&(r=n.replace("date-end","date-end-timestamp")),r&&e(t).find('input[name="'+r+'"]').val(i)}})}function a(){i.on("click",".hb-pricing-controls a",function(t){var a=e(this),i=a.closest(".hb-pricing-table"),n=a.data("action");switch(t.preventDefault(),n){case"clone":var r=!1;e(".hb-pricing-table").length<1&&(r=!0);var s=e(wp.template("hb-pricing-table")({clone:r})),c=s.find(".hb-pricing-price");s.hide().css("background-color","#00A0D2").css("transition","background-color 0.5s"),o(s),i.find(".hb-pricing-price").each(function(e){c.eq(e).val(this.value)}),i.hasClass("regular-price")?(s.removeClass("regular-price"),e(".hb-pricing-table-title > span",s).html("Date Range"),e("#hb-pricing-plan-list").append(s)):s.insertAfter(i),s.fadeTo(350,.8).delay(1e3).fadeTo(250,1,function(){e(this).css("background-color",""),e(".dashicons-edit",this).trigger("click")}),e("#hb-no-plan-message").hide();break;case"edit":a.hasClass("dashicons-edit")?(e("input",i).removeAttr("readonly"),e("input",i).datepicker("enable"),a.removeClass("dashicons-edit").addClass("dashicons-yes"),e(".hb-pricing-table .dashicons-yes").not(a).trigger("click")):(e("input",i).attr("readonly","readonly"),e("input",i).datepicker("disable"),a.removeClass("dashicons-yes").addClass("dashicons-edit"));break;case"remove":confirm(hotel_booking_i18n.confirm_remove_pricing_table)&&(0==i.siblings(".hb-pricing-table").length&&e("#hb-no-plan-message").show(),i.remove())}return!1}),e("#tp_hotel_booking_pricing #hb-room-select").change(function(){var e=window.location.href;e=e.replace(/[&]?hb-room=[0-9]+/,""),0!=this.value&&(e+="&hb-room="+this.value),window.location.href=e}),e('form[name="pricing-table-form"]').submit(function(){var o=!0;return e(".hb-pricing-table").each(function(a){var i=e(this),n=i.find('input[name^="date-start"]'),r=i.find('input[name^="date-end"]');return i.hasClass("regular-price")||(t(n.datepicker("getDate"))?t(r.datepicker("getDate"))||(alert(hotel_booking_i18n.empty_pricing_plan_start_date),r.focus(),o=!1):(alert(hotel_booking_i18n.empty_pricing_plan_start_date),n.focus(),o=!1),o)?void i.find('input[type="text"], input[type="number"], input[type="hidden"]').each(function(){var t=e(this),o=t.attr("name");o=o.replace(/__INDEX__/,a-1e3),t.attr("name",o)}):!1}),o}),e(".hb-pricing-table").each(function(){o(this)}),e(".datetime-picker-metabox").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,minDate:0,maxDate:"+365D",numberOfMonths:2,onSelect:function(){var t=e(this),o=t.attr("name"),a=jQuery(this).datepicker("getDate"),i=new Date(a).getTime()/1e3-60*(new Date).getTimezoneOffset();a&&a.setDate(a.getDate()+1),e('input[name="'+o+'_timestamp"]').val(i)}}),e("#datepickerImage").click(function(){e("#txtFromDate").datepicker("show")}),e(".hb-add-new-plan").click(function(){if(!(e(".hb-pricing-table").length>=2)){var t=e(wp.template("hb-pricing-table")({}));e("#hb-pricing-plan-list").prepend(t),o(t),t.css("opacity",0).css("background-color","#00A0D2").css("transition","background-color 0.5s"),e(window).scrollTop()>t.offset().top-100&&e(window).scrollTop(t.offset().top-100),t.fadeTo(350,.8).delay(1e3).fadeTo(250,1,function(){e(this).css("background-color",""),e('a[data-action="edit"]',t).trigger("click")}),e("#hb-no-plan-message").hide()}}),e("#hb-booking-date-from").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var t=e(this),o=t.datepicker("getDate"),a=new Date(o).getTime()/1e3-60*(new Date).getTimezoneOffset();t.parent().find('input[name="date-from-timestamp"]').val(a),e("#hb-booking-date-to").datepicker("option","minDate",o)}}),e("#hb-booking-date-to").datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var t=e(this),o=t.datepicker("getDate"),a=new Date(o).getTime()/1e3-60*(new Date).getTimezoneOffset();t.parent().find('input[name="date-to-timestamp"]').val(a),e("#hb-booking-date-from").datepicker("option","maxDate",o)}}),e("form#posts-filter").submit(function(){var t=0;return e('#hb-booking-date-from, #hb-booking-date-to, select[name="filter-type"]').each(function(){e(this).val()&&t++}),t>0&&3>t?(alert(hotel_booking_i18n.filter_error),!1):void 0}),e("#gallery_settings").on("click",".attachment.add-new",function(t){t.preventDefault();var o=wp.media.frames.file_frame=wp.media({multiple:!0}),a=e(this);o.on("select",function(){for(var e=o.state().get("selection").toJSON(),t="",i=0;i<e.length;i++){{var n=e[i];n.url.replace(hotel_settings.upload_base_url,"")}t+='<li class="attachment">',t+='<div class="attachment-preview">',t+='<div class="thumbnail">',t+='<div class="centered">',t+='<img src="'+n.url+'"/>',t+='<input type="hidden" name="_hb_gallery[]" value="'+n.id+'" />',t+="</div>",t+="</div>",t+="</div>",t+='<a class="dashicons dashicons-trash" title="Remove this image"></a>',t+="</li>"}a.before(t)}),o.open()}).on("click",".attachment .dashicons-trash",function(t){t.preventDefault(),e(this).parent().remove()}),e('form[name="hb-admin-settings-form"] select').select2(),e("#hb-booking-details select").select2(),e('input[name="tp_hotel_booking_email_new_booking_enable"]').on("change _change",function(){var t=e(this).closest("tr").siblings("."+e(this).attr("name"));this.checked?t.show():t.hide()}).trigger("change"),e("#gallery_settings ul").sortable(),e(".tp_hotel_booking_tabs_settings li a:first").addClass("active"),e(".tp_hotel_booking_setting_fields:first").addClass("active"),e(document).on("click",".tp_hotel_booking_tabs_settings li a",function(t){t.preventDefault();var o=e(this),a=o.attr("href"),i=e(a);"undefined"!=typeof a&&(e(".tp_hotel_booking_setting_fields").removeClass("active"),e(".tp_hotel_booking_tabs_settings li a").removeClass("active"),o.addClass("active"),1===i.length&&i.addClass("active"))})}var i=e(document);void 0==Date.prototype.compareWith&&(Date.prototype.compareWith=function(e){"string"==typeof e&&(e=new Date(e));var t=parseInt(this.getTime()/1e3),o=parseInt(e.getTime()/1e3);return t>o?1:o>t?-1:0}),i.ready(a),Hotel_Booking_Order={init:function(){var t=e(document),o=this;o.select2(),t.on("click",".section h4 .edit",o.edit_customer),t.on("change","#booking-item-checkall",o.toggle_checkbox),t.on("click","#add_room_item",o.add_room_item).on("click","#add_coupon",o.add_coupon).on("click","#remove_coupon",o.remove_coupon).on("click","#action_sync",o.action_sync).on("click","#booking_items .actions .edit",o.edit_room).on("click","#booking_items .actions .remove",o.remove_room).on("hb_modal_open",this.openCallback).on("hb_check_available_action",this.check_available).on("hb_before_update_action",this.save_action)},edit_customer:function(t){t.preventDefault();var o=e(this),a=o.parents(".section:first"),i=a.find(".details"),n=a.find(".edit_details");n.hasClass("active")||(o.hide(),i.hide(),n.addClass("active"))},toggle_checkbox:function(t){t.preventDefault();var o=e(this),a=e('#booking_items input[name*="book_item"]');o.is(":checked")?a.attr("checked",!0):a.attr("checked",!1)},edit_customer:function(t){t.preventDefault();var o=e(this),a=o.parents(".section:first"),i=a.find(".details"),n=a.find(".edit_details");n.hasClass("active")||(o.hide(),i.hide(),n.addClass("active"))},toggle_checkbox:function(t){t.preventDefault();var o=e(this),a=e('#booking_items input[name*="book_item"]');o.is(":checked")?a.attr("checked",!0):a.attr("checked",!1)},select2:function(){e("#booking_details_section #_hb_user_id").select2({placeholder:hotel_booking_i18n.select_user,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",quietMillis:50,data:function(e){return{user_name:e.term,action:"hotel_booking_load_order_user",nonce:hotel_settings.nonce}},processResults:function(t){return{results:e.map(t,function(e){return{text:e.user_login+"(#"+e.ID+" "+e.user_email+")",id:e.ID}})}},cache:!0}})},add_room_item:function(t){t.preventDefault();var o=e(this),a=o.attr("data-order-id");return e(this).hb_modal_box({tmpl:"hb-add-room",settings:{order_id:a}}),!1},add_coupon:function(t){t.preventDefault();var o=e(this),a=o.attr("data-order-id");return e(this).hb_modal_box({tmpl:"hb-coupons",settings:{order_id:a}}),!1},remove_coupon:function(t){t.preventDefault();var o=e(this),a=o.attr("data-order-id"),i=o.attr("data-coupon-id");return e(this).hb_modal_box({tmpl:"hb-confirm",settings:{order_id:a,coupon_id:i,action:"hotel_booking_remove_coupon_on_order"}}),!1},action_sync:function(t){t.preventDefault();var o=e(this),a=e("#hb-booking-items"),i=(a.find(".hb_overlay"),e('input[name*="book_item"]:checked')),n={};if(_do_process=!1,i.length>0){_do_process=!0;for(var r=0;r<i.length;r++)n[r]=e(i[r]).val()}return _do_process&&o.hb_modal_box({tmpl:"hb-confirm",settings:{order_id:o.attr("data-order-id"),order_item_id:n,action:"hotel_booking_admin_remove_order_items"}}),!1},edit_room:function(t){t.preventDefault();var o=e(this),a=o.attr("data-order-id"),i=o.attr("data-order-item-id"),n=o.attr("data-order-item-type"),r=(o.attr("data-order-item-parent"),o.find(".fa"));return e.ajax({url:ajaxurl,type:"POST",data:{order_id:a,order_item_id:i,order_item_type:n,action:"hotel_booking_load_order_item",nonce:hotel_settings.nonce},beforeSend:function(){r.addClass("fa-spin")}}).done(function(e){r.removeClass("fa-spin"),o.hb_modal_box({tmpl:"hb-add-room",settings:e})}),!1},remove_room:function(t){t.preventDefault();var o=e(this);return o.hb_modal_box({tmpl:"hb-confirm",settings:{order_id:o.attr("data-order-id"),order_item_id:o.attr("data-order-item-id"),action:"hotel_booking_admin_remove_order_item"}}),!1},openCallback:function(t,o,a){if(t.preventDefault(),"hb-add-room"===o){var i=a.find(".check_in_date"),n=a.find(".check_out_date"),r=a.find(".booking_search_room_items");r.select2({placeholder:hotel_booking_i18n.select_room,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",quietMillis:50,data:function(e){return{room:e.term,action:"hotel_booking_load_room_ajax",nonce:hotel_settings.nonce}},processResults:function(t){return{results:e.map(t,function(e){return{text:e.post_title,id:e.ID}})}},cache:!0}}),i.datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var t=e(this),o=t.datepicker("getDate"),a=new Date(o).getTime()/1e3-60*(new Date).getTimezoneOffset();t.parent().find('input[name="check_in_date_timestamp"]').val(a),n.datepicker("option","minDate",o)}}),n.datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,onSelect:function(){var t=e(this),o=t.datepicker("getDate"),a=new Date(o).getTime()/1e3-60*(new Date).getTimezoneOffset();t.parent().find('input[name="check_out_date_timestamp"]').val(a),i.datepicker("option","maxDate",o)}})}else if("hb-coupons"===o){var r=a.find(".booking_coupon_code");r.select2({placeholder:hotel_booking_i18n.select_coupon,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",quietMillis:50,data:function(e){return{coupon:e.term,action:"hotel_booking_load_coupon_ajax",nonce:hotel_settings.nonce}},processResults:function(t){return{results:e.map(t,function(e){return{text:e.post_title,id:e.ID}})}},cache:!0}})}},check_available:function(t,o,a){t.preventDefault();var i=e(".form_footer .check_available");a.push({name:"action",value:"hotel_booking_check_room_available"}),e.ajax({url:ajaxurl,type:"POST",data:a,beforeSend:function(){i.append('<i class="fa fa-spinner fa-spin"></i>'),e('select[name="qty"]').remove()}}).done(function(t){return i.find(".fa").remove(),"undefined"!=typeof t.status?t.status===!1&&"undefined"!=typeof t.message?void alert(t.message):void e("#hb_modal_dialog .section:last-child").append(wp.template("hb-qty")(t)):void 0})},save_action:function(t,o,a){var i=e("#hb-booking-items"),n=i.find(".hb_overlay");e.ajax({url:ajaxurl,type:"POST",data:a,beforeSend:function(){n.addClass("active")}}).done(function(t){n.removeClass("active"),"undefined"!=typeof t.status&&(t.status===!0?e("#hb-booking-items").html(t.html):"undefined"!=typeof t.message&&alert(t.message))})}},e(document).ready(function(){Hotel_Booking_Order.init()})}(jQuery),function(e,t){e.fn.hb_modal_box=function(t){var t=e.extend({},{tmpl:"",settings:{}},t);t.tmpl&&new o.view(t.tmpl,t.settings)};var o={view:function(o,a){var i=t.View.extend({id:"hb_modal_dialog",options:a,target:o,events:{"click .hb_modal_close":"close","click .hb_modal_overlay":"close","click .hb_form_submit":"submit","click .check_available":"check_available"},initialize:function(){this.render()},render:function(){var t=wp.template(this.target);t=t(this.options),e("body").append(this.$el.html(t));{var o=e(".hb_modal"),a=o.outerWidth(),i=o.outerHeight();e(window).width(),e(window).height(),e("#wpadminbar").innerWidth()}o.css({"margin-top":"-"+i/2+"px","margin-left":"-"+a/2+"px"}),e(document).trigger("hb_modal_open",[this.target,o.find("form")])},submit:function(){return e(document).trigger("hb_before_update_action",[this.target,this.form_data()]),this.close(),e(document).trigger("hb_before_updated_action",[this.target,this.form_data()]),!1},close:function(){return e(document).trigger("hb_before_close_action",[this.target,this.form_data()]),this.$el.remove(),!1},check_available:function(){return e(document).trigger("hb_check_available_action",[this.target,this.form_data()]),!1},form_data:function(){return _form=e(this.$el).find("form:first-child").serializeArray()}});return new i(a)}}}(jQuery,Backbone,_);